---
- name: get telegraf
  get_url: url={{telegraf_uri}} dest=/tmp/telegraf_{{telegraf_version}}.deb  mode=0740 timeout=250
- name: install telegraf
  apt: deb=/tmp/telegraf_{{telegraf_version}}.deb
- name: allow docker access to telegraf
  user: name=telegraf
        shell=/bin/bash
        group=docker
        append=yes
- name: cleanup
  file: path=/tmp/telegraf_{{telegraf_version}}.deb state=absent
- name: Assures /etc/telegraf dir exists
  file: path=/etc/telegraf state=directory
- name: Provision Telegraf Config
  copy: src=telegraf.conf dest=/etc/telegraf/telegraf.conf owner=pirate mode="u=r,g=r,o=r"
  notify:
      - reload systemd
